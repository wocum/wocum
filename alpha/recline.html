<!DOCTYPE html>
<html lang="en">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  	<link href="http://netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.no-icons.min.css" rel="stylesheet">
  	<link href="http://netdna.bootstrapcdn.com/font-awesome/3.2.1/css/font-awesome.min.css" rel="stylesheet">
	<meta charset="utf-8">
	<meta name="description" content="google drive powered CMS">
	<meta name="author" content="wocum.com">
	<title>wocum - google drive powered CMS</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
	<script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.10.3/jquery-ui.min.js"></script>
	<script src="http://cdnjs.cloudflare.com/ajax/libs/jquery-ui-map/3.0-rc1/jquery.ui.map.js"></script>
	<script type="text/javascript" src="http://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.0.0-rc2/js/bootstrap.min.js"></script>
	<script type="text/javascript" async="" src="http://www.google-analytics.com/ga.js"></script>
	<script src="http://cdnjs.cloudflare.com/ajax/libs/handlebars.js/1.0.0/handlebars.min.js"></script>


<!-- recline test -->

<!-- bootstrap -->
  <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
  <!--[if lt IE 9]>
    <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
 <!-- <link rel="stylesheet" href="http://googledrive.com/host/0B0YWdwxH6K5XZEg3VTZqMzVzYzQ/vendor/bootstrap/2.0.2/css/bootstrap.css" /> -->

  <link rel="stylesheet" href="http://googledrive.com/host/0B0YWdwxH6K5XZEg3VTZqMzVzYzQ/vendor/leaflet/0.4.4/leaflet.css">
  <!--[if lte IE 8]>
  <link rel="stylesheet" href="vendor/leaflet/0.4.4/leaflet.ie.css" />
  <![endif]-->
  <link rel="stylesheet" href="http://googledrive.com/host/0B0YWdwxH6K5XZEg3VTZqMzVzYzQ/vendor/leaflet.markercluster/MarkerCluster.css">
  <link rel="stylesheet" href="http://googledrive.com/host/0B0YWdwxH6K5XZEg3VTZqMzVzYzQ/vendor/leaflet.markercluster/MarkerCluster.Default.css">
  <!--[if lte IE 8]>
  <link rel="stylesheet" href="vendor/leaflet.markercluster/MarkerCluster.Default.ie.css" />
  <![endif]-->
  <link rel="stylesheet" href="http://googledrive.com/host/0B0YWdwxH6K5XZEg3VTZqMzVzYzQ/vendor/slickgrid/2.0.1/slick.grid.css">
  <link rel="stylesheet" href="http://googledrive.com/host/0B0YWdwxH6K5XZEg3VTZqMzVzYzQ/vendor/timeline/css/timeline.css">

  <!-- Recline CSS components -->
  <link rel="stylesheet" href="http://googledrive.com/host/0B0YWdwxH6K5XZEg3VTZqMzVzYzQ/css/grid.css">
  <link rel="stylesheet" href="http://googledrive.com/host/0B0YWdwxH6K5XZEg3VTZqMzVzYzQ/css/slickgrid.css">
  <link rel="stylesheet" href="http://googledrive.com/host/0B0YWdwxH6K5XZEg3VTZqMzVzYzQ/css/flot.css">
  <link rel="stylesheet" href="http://googledrive.com/host/0B0YWdwxH6K5XZEg3VTZqMzVzYzQ/css/map.css">
  <link rel="stylesheet" href="http://googledrive.com/host/0B0YWdwxH6K5XZEg3VTZqMzVzYzQ/css/multiview.css">
  <link rel="stylesheet" href="http://googledrive.com/host/0B0YWdwxH6K5XZEg3VTZqMzVzYzQ/css/timeline.css">
  <!-- /Recline CSS components -->

  <!-- 3rd party JS libraries -->
<!--  <script type="text/javascript" src="http://googledrive.com/host/0B0YWdwxH6K5XZEg3VTZqMzVzYzQ/vendor/jquery/1.7.1/jquery.js"></script> -->
  <script type="text/javascript" src="http://googledrive.com/host/0B0YWdwxH6K5XZEg3VTZqMzVzYzQ/vendor/underscore/1.4.4/underscore.js"></script>
  <script type="text/javascript" src="http://googledrive.com/host/0B0YWdwxH6K5XZEg3VTZqMzVzYzQ/vendor/backbone/1.0.0/backbone.js"></script>
  <script type="text/javascript" src="http://googledrive.com/host/0B0YWdwxH6K5XZEg3VTZqMzVzYzQ/vendor/mustache/0.5.0-dev/mustache.js"></script>
  <script type="text/javascript" src="http://googledrive.com/host/0B0YWdwxH6K5XZEg3VTZqMzVzYzQ/vendor/bootstrap/2.0.2/bootstrap.js"></script>
  <!--[if lte IE 8]>
  <script language="javascript" type="text/javascript" src="vendor/flot/excanvas.min.js"></script>
  <![endif]-->
  <script type="text/javascript" src="http://googledrive.com/host/0B0YWdwxH6K5XZEg3VTZqMzVzYzQ/vendor/flot/jquery.flot.js"></script>
  <script type="text/javascript" src="http://googledrive.com/host/0B0YWdwxH6K5XZEg3VTZqMzVzYzQ/vendor/leaflet/0.4.4/leaflet.js"></script>
  <script type="text/javascript" src="http://googledrive.com/host/0B0YWdwxH6K5XZEg3VTZqMzVzYzQ/vendor/leaflet.markercluster/leaflet.markercluster.js"></script>
  <script type="text/javascript" src="http://googledrive.com/host/0B0YWdwxH6K5XZEg3VTZqMzVzYzQ/vendor/slickgrid/2.0.1/jquery-ui-1.8.16.custom.min.js"></script>
  <script type="text/javascript" src="http://googledrive.com/host/0B0YWdwxH6K5XZEg3VTZqMzVzYzQ/vendor/slickgrid/2.0.1/jquery.event.drag-2.0.min.js"></script>
  <script type="text/javascript" src="http://googledrive.com/host/0B0YWdwxH6K5XZEg3VTZqMzVzYzQ/vendor/slickgrid/2.0.1/slick.grid.min.js"></script>
  <script type="text/javascript" src="http://googledrive.com/host/0B0YWdwxH6K5XZEg3VTZqMzVzYzQ/vendor/moment/2.0.0/moment.js"></script>
  <script type="text/javascript" src="http://googledrive.com/host/0B0YWdwxH6K5XZEg3VTZqMzVzYzQ/vendor/timeline/js/timeline.js"></script>
  <!--[if lte IE 7]>
  <script language="javascript" type="text/javascript" src="vendor/json/json2.js"></script>
  <![endif]-->

  <!--
    ## Just use the all in one library version rather than individual files

  <script type="text/javascript" src="dist/recline.js"></script>

  -->

  <!-- model and backends -->
  <script type="text/javascript" src="http://googledrive.com/host/0B0YWdwxH6K5XZEg3VTZqMzVzYzQ/src/ecma-fixes.js"></script>
  <script type="text/javascript" src="http://googledrive.com/host/0B0YWdwxH6K5XZEg3VTZqMzVzYzQ/src/model.js"></script>
  <script type="text/javascript" src="http://googledrive.com/host/0B0YWdwxH6K5XZEg3VTZqMzVzYzQ/src/backend.memory.js"></script>
  <script type="text/javascript" src="http://googledrive.com/host/0B0YWdwxH6K5XZEg3VTZqMzVzYzQ/src/backend.dataproxy.js"></script>
 <!-- <script type="text/javascript" src="http://googledrive.com/host/0B0YWdwxH6K5XZEg3VTZqMzVzYzQ/src/backend.gdocs.js"></script> -->
 <!--  <script type="text/javascript" src="http://googledrive.com/host/0B0YWdwxH6K5XZEg3VTZqMzVzYzQ/src/backend.elasticsearch.js"></script> -->
  <script type="text/javascript" src="http://googledrive.com/host/0B0YWdwxH6K5XZEg3VTZqMzVzYzQ/src/backend.csv.js"></script>

  <!-- views -->
  <script type="text/javascript" src="http://googledrive.com/host/0B0YWdwxH6K5XZEg3VTZqMzVzYzQ/src/view.grid.js"></script>
  <script type="text/javascript" src="http://googledrive.com/host/0B0YWdwxH6K5XZEg3VTZqMzVzYzQ/src/view.slickgrid.js"></script>
  <script type="text/javascript" src="http://googledrive.com/host/0B0YWdwxH6K5XZEg3VTZqMzVzYzQ/src/view.flot.js"></script>
  <script type="text/javascript" src="http://googledrive.com/host/0B0YWdwxH6K5XZEg3VTZqMzVzYzQ/src/view.graph.js"></script>
  <script type="text/javascript" src="http://googledrive.com/host/0B0YWdwxH6K5XZEg3VTZqMzVzYzQ/src/view.map.js"></script>
  <script type="text/javascript" src="http://googledrive.com/host/0B0YWdwxH6K5XZEg3VTZqMzVzYzQ/src/view.timeline.js"></script>
  <script type="text/javascript" src="http://googledrive.com/host/0B0YWdwxH6K5XZEg3VTZqMzVzYzQ/src/widget.pager.js"></script>
  <script type="text/javascript" src="http://googledrive.com/host/0B0YWdwxH6K5XZEg3VTZqMzVzYzQ/src/widget.queryeditor.js"></script>
  <script type="text/javascript" src="http://googledrive.com/host/0B0YWdwxH6K5XZEg3VTZqMzVzYzQ/src/widget.filtereditor.js"></script>
  <script type="text/javascript" src="http://googledrive.com/host/0B0YWdwxH6K5XZEg3VTZqMzVzYzQ/src/widget.valuefilter.js"></script>
  <script type="text/javascript" src="http://googledrive.com/host/0B0YWdwxH6K5XZEg3VTZqMzVzYzQ/src/widget.facetviewer.js"></script>
  <script type="text/javascript" src="http://googledrive.com/host/0B0YWdwxH6K5XZEg3VTZqMzVzYzQ/src/widget.fields.js"></script>
  <script type="text/javascript" src="http://googledrive.com/host/0B0YWdwxH6K5XZEg3VTZqMzVzYzQ/src/view.multiview.js"></script>


</head>
<body>
<div class="container">
  <div id="wocum"></div>
<div id="wocum-recline-dataset-record-count">hh</div>
<div id="mygrid" style="height: 400px">jj</div>
<div id="mygraph">hh</div>
</div>

<script type="text/javascript">
function GetURLParameter(sParam) {
var sPageURL = window.location.search.substring(1);
var sURLVariables = sPageURL.split('&');
for (var i = 0; i < sURLVariables.length; i++)
{
var sParameterName = sURLVariables[i].split('=');
if (sParameterName[0] == sParam)
{
return sParameterName[1];
}
}
}
var gskey = GetURLParameter('key') || '0AkYWdwxH6K5XdFRILW9XRzRicjhZZU9icXlNckFtdUE';
var slug = GetURLParameter('id') || 'home';
document.title = "wocum - "+ slug;

function pageHandler (response) {
try 
{
window.wocumJSON = response.table.rows[0].c[0].v;
wocumTemplate = response.table.rows[0].c[1].v;
var template = Handlebars.compile(wocumTemplate);
window.wocumListTemplate = response.table.rows[0].c[2].v;
var context = jQuery.parseJSON(wocumJSON);
var handlebarsHTML    = template(context);
document.getElementById("wocum").innerHTML = handlebarsHTML;
getFilesAndRelations ();
}
catch (err)
{
$.getScript('http://spreadsheets.google.com/tq?key='+gskey+'&range=wocum!A:C&tq=select%20B,C%20where%20A%20%3D%20%22non-existing%22&tqx=responseHandler:nonExistingPageHandler');
}
}

function nonExistingPageHandler (response) {
try 
{
wocumJSON = '\{\"id\":\"'+slug+'\",\"name\":\"'+slug+'\"\}';
wocumTemplate = response.table.rows[0].c[1].v;
var template = Handlebars.compile(wocumTemplate);
var context = jQuery.parseJSON(wocumJSON);
var handlebarsHTML    = template(context);
document.getElementById("wocum").innerHTML = handlebarsHTML;
getFilesAndRelations ();
}
catch (err)
{
document.getElementById("wocum").innerHTML = 'Something went wrong. Hopefully you are not using this software to manage a nuclear reactor';
}
}

function getFilesAndRelations () {
$.getScript('http://spreadsheets.google.com/tq?key='+gskey+'&range=src_files!C:D&tq=select%20D%20where%20C%20contains%20%22'+slug+'%22&tqx=responseHandler:filesHandler');
$.getScript('http://spreadsheets.google.com/tq?key='+gskey+'&range=wocum!B:B&tq=select%20B%20where%20B%20contains%20%22'+slug+'%22&tqx=responseHandler:incomingRelationsHandler');
}

function filesHandler (response) {
var files = $.map(response.table.rows, function(item, index) {
return item.c[0].v;
});
if (typeof files !== 'undefined' && files.length > 0) {
files[0] = files[0].replace("item","active item");
document.getElementById("files-list").innerHTML= files.join('');
var showMedia = document.getElementById("wocum-media").style.display = 'inline';
}
}

function incomingRelationsHandler (response) {
incomingRelationsRaw = $.map(response.table.rows, function(item, index) {
return item.c[0].v;
});
$(document).data('wocum.reclineData', '[' + incomingRelationsRaw + ']');
//window.reclineData = '[' + window.incomingRelationsRaw.join(',') + ']';
incomingRelations = '{"relations":['+incomingRelationsRaw+']}';  
if (typeof incomingRelations !== 'undefined' && incomingRelations.length > 0) {
var templateRelations = Handlebars.compile(window.wocumListTemplate);
var context = jQuery.parseJSON(incomingRelations);
var handlebarsHTML    = templateRelations(context);
document.getElementById("relations-list").innerHTML=handlebarsHTML;
var showRelations = document.getElementById("wocum-relations").style.display = 'inline';
var data = jQuery.parseJSON($(document).data('wocum.reclineData'));
alert(data);
/*
var data = [
  {id: 1, date: '2011-02-02', x: 2, y: 4, z: 24, country: 'UK', geo: {lat:54.97, lon:-1.60}},
  {id: 2, date: '2011-03-03', x: 3, y: 6, z: 9, country: 'US', geo: {lat:40.00, lon:-75.5}},
  {id: 3, date: '2011-04-04', x: 4, y: 8, z: 6, country: 'UK', geo: {lat:57.27, lon:-6.20}},
  {id: 4, date: '2011-05-04', x: 5, y: 10, z: 15, country: 'UK', geo: {lat:51.58, lon:0}},
];
*/

var dataset = new recline.Model.Dataset({
  records: data
});

var field = new Field({
  // a unique identifer for this field- usually this should match the key in the records hash
  id: 'location'

  // (optional: defaults to string) the type of the data in this field.
  // For list of type names see below
  type: 'geo_point',
});

document.getElementById("wocum-recline-dataset-record-count").innerHTML = 'Total records found: ' + dataset.recordCount + '<br />';

/*
var $el = $('#mygrid');
var grid = new recline.View.SlickGrid({
  model: dataset,
  el: $el
});
grid.visible = true;
grid.render();
*/
var $el = $('#mygraph');

var map = new recline.View.Map({
  model: dataset
});
$el.append(map.el);
map.render();

//end of recline

(function($) {

  $('.filterinput').keyup(function() {
    var a = $(this).val();
    if (a.length > 2) {
      // this finds all links in the list that contain the input, and hide the ones not containing the input while showing the ones that do
      var containing = $('#relations-list li').filter(function () {
        var regex = new RegExp('\\b' + a, 'i');
        return regex.test($('a', this).text());
      }).slideDown();
      $('#relations-list li').not(containing).slideUp();
    } else {
      $('#relations-list li').slideDown();
    }
  return false;
})
}(jQuery));
}
}


</script>
<script type="text/javascript">
(function () {
$.getScript('http://spreadsheets.google.com/tq?key='+gskey+'&range=wocum!A:D&tq=select%20B,C,D%20where%20A%20%3D%20%22'+slug+'%22&tqx=responseHandler:pageHandler');
})()
</script>
</body></html>
